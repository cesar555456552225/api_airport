<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distancia entre aeropuertos</title>
</head>
<body>
    <h1>Distancia entre aeropuertos</h1>

    <form id="airportForm">
        {% csrf_token %}
        <label for="aeropuerto_origen">Aeropuerto Origen</label>
        <input 
        type="text"
        id="aeropuerto_origen"
        name="aeropuerto_origen"
        placeholder="Ej: CCS"
        maxlength="3"
        required
        >
        <br><br>

        <label for="aeropuerto_destino">Aeropuerto destino</label>
        <input 
        type="text"
        id="aeropuerto_destino"
        name="aeropuerto_destino"
        placeholder="Ej: BOG"
        maxlength="3"
        required
        >

        <br><br>

        <button type="submit">Calcular distancia</button>
    </form>

    <div id="resultados">
        <h2><strong>Resultados</strong></h2>
        <p><strong>Origen:</strong><span id="origen"></span></p>
        <p><strong>Destino:</strong><span id="destino"></span></p>
        <p><strong>Distancia:</strong><span id="distancia"></span>KM</p>
    </div>

    <script>
        document.getElementById('airportForm').addEventListener('submit', function(e){
            e.preventDefault();
            document.getElementById('resultados').style.display='none';
            document.getElementById('error').style.display='none';

            const formData=new FormData(this)

            fetch('/calculate',{
                method:'POST',
                body:formData,
                headers:{
                    'x-CRSFToken': formData.get('csrfmiddlewaretoken')
                }
            })
            .then(Response => response.json())
            .then(data =>{
                if (data.success) {
                    document.getElementById(origen).textContent=
                        data.aeropuerto_origen.codigo + ' - ' + data.aeropuerto_origen.nombre;

                    document.getElementById(destino).textContent = 
                        data.aeropuerto_destino.codigo + ' - ' + data.aeropuerto_destino.nombre;
                    
                    document.getElementById('distancia').textContent = data.distancia_km;
                    document.getElementById('resultado').style.display = 'block';
                }else{
                    document.getElementById('error').textContent = data.error;
                    document.getElementById('error').style.display = 'block';
                }
            })
            .catch(error =>{
                document.getElementById(érror).textContent="Error de conexión";
                document.getElementById('error').style.display='block';
            });
        });
    </script>
</body>
</html>